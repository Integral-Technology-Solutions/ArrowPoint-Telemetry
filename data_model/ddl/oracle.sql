-- Generated by Oracle SQL Developer Data Modeler 3.1.4.710
--   at:        2013-08-07 21:44:34 EST
--   site:      Oracle Database 11g
--   type:      Oracle Database 11g



DROP VIEW ALERTS 
;
DROP TABLE DATA_PNT CASCADE CONSTRAINTS 
;
DROP TABLE DEV CASCADE CONSTRAINTS 
;
DROP TABLE DEV_TYPE CASCADE CONSTRAINTS 
;
DROP TABLE LNG_TERM_TREND_DATA CASCADE CONSTRAINTS 
;
DROP TABLE MED_TERM_TREND_DATA CASCADE CONSTRAINTS 
;
DROP TABLE MSRMNT CASCADE CONSTRAINTS 
;
DROP TABLE MSRMNT_DATA CASCADE CONSTRAINTS 
;
DROP TABLE SHT_TERM_TREND_DATA CASCADE CONSTRAINTS 
;
CREATE TABLE DATA_PNT 
    ( 
     DATA_PNT_ID NUMBER  NOT NULL , 
     DATA_PNT_CAN_ID NUMBER , 
     NAME VARCHAR2 (50) , 
     DESCR VARCHAR2 (256) , 
     DATA_LEN NUMBER , 
     CAN_DATA_OFFST NUMBER , 
     DATA_TYPE VARCHAR2 , 
     LOW_ERR_THRHLD FLOAT , 
     LOW_WRNG_THRHLD FLOAT , 
     HIGH_WRNG_THRHLD FLOAT , 
     HIGH_ERR_THRHLD FLOAT , 
     MSRMNT_ID_FK NUMBER  NOT NULL , 
     UNITS VARCHAR2 (30) 
    ) 
;


CREATE INDEX DATA_PNT__IDXv1 ON DATA_PNT 
    ( 
     DATA_PNT_CAN_ID ASC 
    ) 
;

ALTER TABLE DATA_PNT 
    ADD CONSTRAINT DATA_PNT_PK PRIMARY KEY ( DATA_PNT_ID ) ;



CREATE TABLE DEV 
    ( 
     DEV_ID NUMBER  NOT NULL , 
     DEV_NAME VARCHAR2 (255) , 
     DEV_ABBREV VARCHAR2 (10) 
    ) 
;



ALTER TABLE DEV 
    ADD CONSTRAINT DEV_PK PRIMARY KEY ( DEV_ID ) ;



CREATE TABLE DEV_TYPE 
    ( 
     DEV_TYPE_ID NUMBER  NOT NULL , 
     DEV_TYPE VARCHAR2 (20) 
    ) 
;



ALTER TABLE DEV_TYPE 
    ADD CONSTRAINT DEV_TYPE_PK PRIMARY KEY ( DEV_TYPE_ID ) ;


ALTER TABLE DEV_TYPE 
    ADD CONSTRAINT DEV_TYPE_UK UNIQUE ( DEV_TYPE ) ;



CREATE TABLE LNG_TERM_TREND_DATA 
    ( 
     LNG_TERM_TREND_DATA_ID NUMBER  NOT NULL , 
     DATA_PNT_CAN_ID NUMBER , 
     TSTAMP DATE , 
     EXTD CHAR (1) , 
     RTR CHAR (1) , 
     DATA_LEN NUMBER , 
     FVAL FLOAT , 
     IVAL NUMBER , 
     CVAL CHAR (16) , 
     STATE VARCHAR2 (10) CHECK ( STATE IN ('HighErr', 'HighWarn', 'LowErr', 'LowWarn', 'Normal')) 
    ) 
;


CREATE INDEX LNG_TERM_TREND_DATA_IDXv1 ON LNG_TERM_TREND_DATA 
    ( 
     DATA_PNT_CAN_ID ASC 
    ) 
;
CREATE INDEX LNG_TERM_TREND_DATA_IDXv2 ON LNG_TERM_TREND_DATA 
    ( 
     TSTAMP ASC 
    ) 
;

ALTER TABLE LNG_TERM_TREND_DATA 
    ADD CONSTRAINT LNG_TERM_TREND_DATA_PK PRIMARY KEY ( LNG_TERM_TREND_DATA_ID ) ;



CREATE TABLE MED_TERM_TREND_DATA 
    ( 
     MED_TERM_TREND_DATA_ID NUMBER  NOT NULL , 
     DATA_PNT_CAN_ID NUMBER , 
     TSTAMP DATE , 
     EXTD CHAR (1) , 
     RTR CHAR (1) , 
     DATA_LEN NUMBER , 
     FVAL FLOAT , 
     IVAL NUMBER , 
     CVAL CHAR (16) , 
     STATE VARCHAR2 (10) CHECK ( STATE IN ('HighErr', 'HighWarn', 'LowErr', 'LowWarn', 'Normal')) 
    ) 
;


CREATE INDEX MED_TERM_TREND_DATA_IDXv1 ON MED_TERM_TREND_DATA 
    ( 
     DATA_PNT_CAN_ID ASC 
    ) 
;
CREATE INDEX MED_TERM_TREND_DATA_IDXv2 ON MED_TERM_TREND_DATA 
    ( 
     TSTAMP ASC 
    ) 
;

ALTER TABLE MED_TERM_TREND_DATA 
    ADD CONSTRAINT MED_TERM_TREND_DATA_PK PRIMARY KEY ( MED_TERM_TREND_DATA_ID ) ;



CREATE TABLE MSRMNT 
    ( 
     MSRMNT_ID NUMBER  NOT NULL , 
     MSRMNT_NAME VARCHAR2 (255) , 
     CAN_ID NUMBER , 
     DEV_ID_FK NUMBER , 
     DEV_TYPE_ID_FK NUMBER , 
     REPRTNG_FRQ NUMBER , 
     MSRMNT_TYPE VARCHAR2 
    ) 
;


CREATE INDEX MSRMNT__IDXv1 ON MSRMNT 
    ( 
     CAN_ID ASC 
    ) 
;

ALTER TABLE MSRMNT 
    ADD CONSTRAINT MSRMNT_PK PRIMARY KEY ( MSRMNT_ID ) ;



CREATE TABLE MSRMNT_DATA 
    ( 
     MSRMNT_DATA_ID NUMBER  NOT NULL , 
     DATA_PNT_CAN_ID NUMBER , 
     TSTAMP DATE , 
     EXTD CHAR (1) , 
     RTR CHAR (1) , 
     DATA_LEN NUMBER , 
     FVAL FLOAT , 
     IVAL NUMBER , 
     CVAL CHAR (16) , 
     STATE VARCHAR2 (10) CHECK ( STATE IN ('HighErr', 'HighWarn', 'LowErr', 'LowWarn', 'Normal')) 
    ) 
;


CREATE INDEX MSRMNT_DATA_IDXv1 ON MSRMNT_DATA 
    ( 
     DATA_PNT_CAN_ID ASC 
    ) 
;
CREATE INDEX MSRMNT_DATA_IDXv2 ON MSRMNT_DATA 
    ( 
     TSTAMP ASC 
    ) 
;

ALTER TABLE MSRMNT_DATA 
    ADD CONSTRAINT MSRMNT_DATA_PK PRIMARY KEY ( MSRMNT_DATA_ID ) ;



CREATE TABLE SHT_TERM_TREND_DATA 
    ( 
     SHT_TERM_TREND_DATA_ID NUMBER  NOT NULL , 
     DATA_PNT_CAN_ID NUMBER , 
     TSTAMP DATE , 
     EXTD CHAR (1) , 
     RTR CHAR (1) , 
     DATA_LEN NUMBER , 
     FVAL FLOAT , 
     IVAL NUMBER , 
     CVAL CHAR (16) , 
     STATE VARCHAR2 (10) CHECK ( STATE IN ('HighErr', 'HighWarn', 'LowErr', 'LowWarn', 'Normal')) 
    ) 
;


CREATE INDEX SHT_TERM_TREND_DATA_IDXv1 ON SHT_TERM_TREND_DATA 
    ( 
     DATA_PNT_CAN_ID ASC 
    ) 
;
CREATE INDEX SHT_TERM_TREND_DATA_IDXv2 ON SHT_TERM_TREND_DATA 
    ( 
     TSTAMP ASC 
    ) 
;

ALTER TABLE SHT_TERM_TREND_DATA 
    ADD CONSTRAINT SHT_TERM_TREND_DATA_PK PRIMARY KEY ( SHT_TERM_TREND_DATA_ID ) ;




ALTER TABLE MSRMNT 
    ADD CONSTRAINT DEV_MSRMNT FOREIGN KEY 
    ( 
     DEV_ID_FK
    ) 
    REFERENCES DEV 
    ( 
     DEV_ID
    ) 
;


ALTER TABLE DATA_PNT 
    ADD CONSTRAINT MSRMNT_DATA_PNT FOREIGN KEY 
    ( 
     MSRMNT_ID_FK
    ) 
    REFERENCES MSRMNT 
    ( 
     MSRMNT_ID
    ) 
;


ALTER TABLE MSRMNT 
    ADD CONSTRAINT MSRMNT_DEV_TYPE FOREIGN KEY 
    ( 
     DEV_TYPE_ID_FK
    ) 
    REFERENCES DEV_TYPE 
    ( 
     DEV_TYPE_ID
    ) 
;

CREATE OR REPLACE VIEW ALERTS AS
SELECT t1.DATA_PNT_CAN_ID,
  t1.TSTAMP,
  t1.FVAL,
  t1.IVAL,
  t1.CVAL,
  t1.STATE
FROM MSRMNT_DATA t1
WHERE t1.TSTAMP =
  (SELECT MAX(t2.TSTAMP)
  FROM MSRMNT_DATA t2
  WHERE t1.DATA_PNT_CAN_ID = t2.DATA_PNT_CAN_ID
  )
AND t1.STATE != 'NORMAL' ;





-- Oracle SQL Developer Data Modeler Summary Report: 
-- 
-- CREATE TABLE                             8
-- CREATE INDEX                            10
-- ALTER TABLE                             12
-- CREATE VIEW                              1
-- CREATE PACKAGE                           0
-- CREATE PACKAGE BODY                      0
-- CREATE PROCEDURE                         0
-- CREATE FUNCTION                          0
-- CREATE TRIGGER                           0
-- ALTER TRIGGER                            0
-- CREATE STRUCTURED TYPE                   0
-- CREATE COLLECTION TYPE                   0
-- CREATE CLUSTER                           0
-- CREATE CONTEXT                           0
-- CREATE DATABASE                          0
-- CREATE DIMENSION                         0
-- CREATE DIRECTORY                         0
-- CREATE DISK GROUP                        0
-- CREATE ROLE                              0
-- CREATE ROLLBACK SEGMENT                  0
-- CREATE SEQUENCE                          0
-- CREATE MATERIALIZED VIEW                 0
-- CREATE SYNONYM                           0
-- CREATE TABLESPACE                        0
-- CREATE USER                              0
-- 
-- DROP TABLESPACE                          0
-- DROP DATABASE                            0
-- 
-- ERRORS                                   0
-- WARNINGS                                 0
